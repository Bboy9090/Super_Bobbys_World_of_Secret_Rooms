{
  "version": "1.0.0",
  "workflows": [
    {
      "id": "universal_device_scan_v1",
      "name": "Universal Device Scan",
      "description": "Scan for all connected devices (iOS, Android, Fastboot) - read-only detection",
      "tags": ["scan", "report"],
      "required_gates": ["GATE_OWNERSHIP_ATTESTATION"],
      "steps": [
        {
          "id": "usb_enumerate",
          "name": "USB Enumeration",
          "actionId": "system.usb.enumerate",
          "actionType": "usb_enumeration",
          "retry": {
            "max": 4,
            "backoffMs": [250, 500, 1000, 2000]
          },
          "outputs": ["usb_devices"]
        },
        {
          "id": "adb_list",
          "name": "ADB Device List",
          "actionId": "android.adb.devices",
          "actionType": "adb_scan",
          "retry": {
            "max": 2,
            "backoffMs": [500, 1000]
          },
          "outputs": ["adb_devices"]
        },
        {
          "id": "fastboot_list",
          "name": "Fastboot Device List",
          "actionId": "android.fastboot.devices",
          "actionType": "fastboot_scan",
          "retry": {
            "max": 2,
            "backoffMs": [500, 1000]
          },
          "outputs": ["fastboot_devices"]
        },
        {
          "id": "ios_scan",
          "name": "iOS Device Scan",
          "actionId": "ios.ideviceinfo.identity",
          "actionType": "ios_scan",
          "retry": {
            "max": 1,
            "backoffMs": [500]
          },
          "outputs": ["ios_devices"]
        },
        {
          "id": "ios_recovery_probe",
          "name": "iOS Recovery Mode Probe",
          "actionId": "ios.irecovery.query",
          "actionType": "ios_recovery_scan",
          "retry": {
            "max": 1,
            "backoffMs": [500]
          },
          "outputs": ["ios_recovery_state"]
        },
        {
          "id": "emit_device_passports",
          "name": "Emit Device Passports",
          "actionId": "bobby.emit.device_passports",
          "actionType": "device_passport_emit",
          "outputs": ["device_passports", "trust_states"]
        }
      ]
    },
    {
      "id": "apple_activation_recovery_assistant_v1",
      "name": "Orchard Gate â€” Apple Access & Recovery",
      "description": "Diagnostics + ownership verification + official Apple recovery hand-off. No bypass actions.",
      "tags": ["apple", "recovery", "guidance"],
      "required_gates": ["GATE_OWNERSHIP_ATTESTATION", "GATE_NO_CIRCUMVENTION", "GATE_TOOL_ALLOWLIST"],
      "steps": [
        {
          "id": "device_intake",
          "name": "Device Intake (Read-Only)",
          "actionId": "ios.ideviceinfo.identity",
          "actionType": "device_intake_readonly",
          "inputs": ["platform", "connection_state"],
          "outputs": ["DevicePassport.json"]
        },
        {
          "id": "status_assessment",
          "name": "Activation & Access Status (Read-Only)",
          "actionId": "ios.trapdoor.status",
          "actionType": "status_assessment_readonly",
          "inputs": ["DevicePassport.json", "user_claims"],
          "outputs": ["AccessAssessment.json"]
        },
        {
          "id": "ownership_packet",
          "name": "Ownership Verification Vault",
          "actionId": "bobby.collect.ownership_packet",
          "actionType": "ownership_packet_collect",
          "inputs": ["receipt", "photos", "serial_imei", "attestation"],
          "outputs": ["OwnershipPacket.zip"]
        },
        {
          "id": "support_bundle",
          "name": "Support Bundle Export",
          "actionId": "bobby.bundle.apple_support",
          "actionType": "support_bundle_export",
          "inputs": ["DevicePassport.json", "AccessAssessment.json", "OwnershipPacket.zip"],
          "outputs": ["AppleSupportBundle.zip", "CaseNotes.txt"]
        },
        {
          "id": "official_handoff",
          "name": "Official Recovery Hand-Off",
          "actionId": "bobby.handoff.apple_official",
          "actionType": "official_handoff_links",
          "inputs": ["region"],
          "outputs": ["OfficialLinks.json"]
        }
      ]
    },
    {
      "id": "android_legal_repair_assistant_v1",
      "name": "Android Legal Repair Assistant",
      "description": "OEM-safe diagnostics + restore guidance. Requires authorization for ADB/Fastboot operations.",
      "tags": ["android", "repair", "guidance"],
      "required_gates": ["GATE_OWNERSHIP_ATTESTATION", "GATE_NO_CIRCUMVENTION", "GATE_TOOL_ALLOWLIST"],
      "steps": [
        {
          "id": "device_intake",
          "name": "Device Intake (Read-Only)",
          "actionId": "android.adb.devices",
          "actionType": "device_intake_readonly",
          "inputs": ["platform", "connection_state"],
          "outputs": ["DevicePassport.json"]
        },
        {
          "id": "authorized_diagnostics",
          "name": "Diagnostics (Authorized Only)",
          "actionId": "android.adb.diagnostics",
          "actionType": "authorized_diagnostics",
          "requiredGates": ["GATE_DEVICE_AUTHORIZATION"],
          "inputs": ["DevicePassport.json", "user_authorization"],
          "outputs": ["AndroidDiagnostics.json"]
        },
        {
          "id": "oem_restore_plan",
          "name": "OEM Restore Plan",
          "actionId": "bobby.guidance.oem_restore",
          "actionType": "oem_restore_guidance",
          "inputs": ["DevicePassport.json", "oem_source_links"],
          "outputs": ["RestorePlan.md"]
        },
        {
          "id": "repair_report",
          "name": "Repair Report Export",
          "actionId": "bobby.report.android_repair",
          "actionType": "report_export",
          "inputs": ["AndroidDiagnostics.json", "RestorePlan.md"],
          "outputs": ["RepairReport.md"]
        }
      ]
    }
  ]
}
